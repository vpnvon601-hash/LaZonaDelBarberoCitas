<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Agendar Cita - LA ZONA DEL BARBERO</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
<style>
* { box-sizing: border-box; margin:0; padding:0; }
body, html { height:100%; font-family:'Montserrat',sans-serif; }
body { background: linear-gradient(135deg, #111, #222); display:flex; justify-content:center; align-items:center; }
#splash {
  position:fixed; top:0; left:0; width:100%; height:100%;
  background:#000; display:flex; justify-content:center; align-items:center; color:#fff; font-size:2em; z-index:9999;
  flex-direction: column;
}
.loader {
  border: 6px solid #333;
  border-top: 6px solid #6c63ff;
  border-radius: 50%;
  width: 50px;
  height: 50px;
  animation: spin 1s linear infinite;
  margin-bottom: 15px;
}
@keyframes spin { 0% { transform: rotate(0deg);} 100% { transform: rotate(360deg);} }

.container {
  background-color:#1c1c1c; color:#fff;
  padding:40px 30px; border-radius:20px; width:90%; max-width:400px;
  box-shadow:0 15px 30px rgba(0,0,0,0.5);
  animation: fadeIn 0.8s ease;
}
@keyframes fadeIn { from {opacity:0; transform:translateY(20px);} to {opacity:1; transform:translateY(0);} }

h2 { text-align:center; margin-bottom:25px; font-weight:600; color:#fff; }
input, select, button {
  width:100%; padding:14px; margin:12px 0; border-radius:10px; border:none; font-size:16px; transition:0.3s;
}
input, select { background:#333; color:#fff; }
input:focus, select:focus { outline:none; box-shadow:0 0 8px #6c63ff; }
button {
  background:#6c63ff; color:#fff; font-weight:600; cursor:pointer;
}
button:hover { background:#5751d0; transform:scale(1.02); }

option.unavailable { color:red; font-weight:bold; }

.fechaInput {
  position: relative;
  background:#333; color:#fff; border-radius:10px; padding:14px; border:none; font-size:16px;
}
.fechaInput::-webkit-datetime-edit { color:#fff; }
.fechaInput::before {
  content: "Selecciona fecha";
  position: absolute;
  left: 14px;
  top: 50%;
  transform: translateY(-50%);
  color: #aaa;
  pointer-events: none;
}
.fechaInput:focus::before,
.fechaInput[value]:not([value=""])::before { content: ""; }

/* Responsivo */
@media(max-width:480px){
  .container { padding:30px 20px; border-radius:15px; }
  input, select, button { padding:12px; font-size:14px; }
}
</style>
</head>
<body>

<div id="splash">
  <div class="loader"></div>
  LA ZONA DEL BARBERO
</div>

<div class="container" style="display:none;" id="mainForm">
<h2>Agendar Cita</h2>
<form id="citaForm">
<input type="text" id="nombre" placeholder="Nombre" required>
<input type="text" id="apellido" placeholder="Apellido" required>
<input type="tel" id="telefono" placeholder="Número telefónico" required pattern="[0-9]{10,15}">

<select id="barbero" required>
  <option value="">Selecciona Barbero</option>
  <option value="Dylan">Dylan</option>
  <option value="Santiago">Santiago</option>
  <option value="Alejandro">Alejandro</option>
  <option value="Leonardo">Leonardo</option>
</select>

<input type="date" id="fecha" class="fechaInput" required>

<select id="hora" required></select>
<button type="submit">Agendar Cita</button>
</form>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

<script>
// Splash
setTimeout(()=>{
  document.getElementById('splash').style.display='none';
  document.getElementById('mainForm').style.display='block';
},2000);

// Firebase
const firebaseConfig = {
  apiKey: "AIzaSyD0XwAGFWJEFs6_bpPLQGSVeBPyTkymk6I",
  authDomain: "shantybarber-b7b8c.firebaseapp.com",
  databaseURL: "https://shantybarber-b7b8c-default-rtdb.firebaseio.com",
  projectId: "shantybarber-b7b8c",
  storageBucket: "shantybarber-b7b8c.firebasestorage.app",
  messagingSenderId: "568694643758",
  appId: "1:568694643758:web:c1bbf8a68f6e9e3d4ad3bf",
  measurementId: "G-JXMJM9Q3X1"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const horaSelect = document.getElementById('hora');
const fechaInput = document.getElementById('fecha');
const barberoSelect = document.getElementById('barbero');

// Convertir minutos a AM/PM
function formatHora(h,m){
  let ampm = h>=12?'PM':'AM';
  let hh = h%12; if(hh===0) hh=12;
  let mm = m.toString().padStart(2,'0');
  return `${hh}:${mm} ${ampm}`;
}

// Generar horas
function generarHoras(){
  horaSelect.innerHTML='';
  let start=10*60, end=21*60;
  while(start<end){
    let h=Math.floor(start/60), m=start%60;
    let option=document.createElement('option');
    option.value = formatHora(h,m);
    option.textContent = formatHora(h,m);
    horaSelect.appendChild(option);
    start+=40;
  }
}

// Actualizar horas ocupadas por barbero
function actualizarHoras(){
  const fecha = fechaInput.value;
  const barbero = barberoSelect.value;
  if(!fecha || !barbero) return;
  const ref = db.ref('citas/'+fecha+'/'+barbero);
  ref.on('value', snapshot=>{
    generarHoras();
    const citas = snapshot.val()||{};
    for(let option of horaSelect.options){
      if(citas[option.value]){
        option.disabled = true;
        option.classList.add('unavailable');
        option.textContent = option.value+' - Ocupado';
      }
    }
  });
}

fechaInput.addEventListener('change', actualizarHoras);
barberoSelect.addEventListener('change', actualizarHoras);

// Enviar formulario
document.getElementById('citaForm').addEventListener('submit', function(e){
  e.preventDefault();
  const nombre=document.getElementById('nombre').value;
  const apellido=document.getElementById('apellido').value;
  const telefono=document.getElementById('telefono').value;
  const fecha=document.getElementById('fecha').value;
  const hora=document.getElementById('hora').value;
  const barbero=document.getElementById('barbero').value;
  if(!hora) return alert('Selecciona una hora disponible.');

  db.ref('citas/'+fecha+'/'+barbero+'/'+hora).set({nombre,apellido,telefono});

  const mensaje=`Hola! Quiero agendar una cita:\nNombre: ${nombre}\nApellido: ${apellido}\nTeléfono: ${telefono}\nFecha: ${fecha}\nHora: ${hora}\nBarbero: ${barbero}`;
  const waUrl=`https://wa.me/573233489369?text=${encodeURIComponent(mensaje)}`;
  window.open(waUrl,'_blank');
  alert('Cita agendada correctamente!');
  document.getElementById('citaForm').reset();
  horaSelect.innerHTML='';
});

generarHoras();
</script>
</body>
</html>
