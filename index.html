<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LA ZONA DEL BARBERO</title>
<!-- Tailwind CDN -->
<script src="https://cdn.tailwindcss.com"></script>
<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
  body { background: #111; color: #fff; font-family: 'Arial', sans-serif; }
  .gold { color: #FFD700; }
  .hidden { display: none; }
  .splash { 
    position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
    background: linear-gradient(135deg, #000, #222); display: flex; 
    align-items: center; justify-content: center; flex-direction: column;
    z-index: 50; animation: fadeOut 2s ease forwards 3s;
  }
  @keyframes fadeOut { 100% { opacity: 0; visibility: hidden; } }
</style>
</head>
<body>

<!-- Splash -->
<div class="splash">
  <h1 class="text-4xl gold font-bold animate-pulse">LA ZONA DEL BARBERO</h1>
  <p class="text-gray-400 mt-4 animate-bounce">Cargando...</p>
</div>

<!-- Formulario -->
<div class="max-w-lg mx-auto mt-20 p-6 bg-gray-900 rounded-2xl shadow-lg">
  <h2 class="text-2xl gold font-bold mb-4 text-center">Agendar Cita</h2>
  
  <label class="block mb-2">Selecciona Barbero</label>
  <select id="barbero" class="w-full p-2 mb-4 rounded bg-gray-800 text-white">
    <option value="">-- Escoge un barbero --</option>
    <option value="Dylan">Dylan</option>
    <option value="Santiago">Santiago</option>
    <option value="Alejandro">Alejandro</option>
    <option value="Leonardo">Leonardo</option>
  </select>

  <input type="text" id="nombre" placeholder="Nombre" class="w-full p-2 mb-4 rounded bg-gray-800 text-white">
  <input type="text" id="apellido" placeholder="Apellido" class="w-full p-2 mb-4 rounded bg-gray-800 text-white">
  
  <label class="block mb-2">Fecha de la cita</label>
  <input type="date" id="fecha" class="w-full p-2 mb-4 rounded bg-gray-800 text-white">

  <label class="block mb-2">Hora de la cita</label>
  <select id="hora" class="w-full p-2 mb-4 rounded bg-gray-800 text-white">
    <option value="">-- Escoge una hora --</option>
  </select>

  <button id="enviar" class="w-full p-3 bg-gold hover:bg-yellow-500 text-black font-bold rounded">Agendar Cita ‚úÇÔ∏èüíà</button>
</div>

<script>
  // Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyD0XwAGFWJEFs6_bpPLQGSVeVPyTkymk6I",
    authDomain: "shantybarber-b7b8c.firebaseapp.com",
    databaseURL: "https://shantybarber-b7b8c-default-rtdb.firebaseio.com",
    projectId: "shantybarber-b7b8c",
    storageBucket: "shantybarber-b7b8c.firebasestorage.app",
    messagingSenderId: "568694643758",
    appId: "1:568694643758:web:c1bbf8a68f6e9e3d4ad3bf",
    measurementId: "G-JXMJM9Q3X1"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // Generar horas de 40 min
  const horasSelect = document.getElementById('hora');
  function generarHoras() {
    let start = 10*60; // 10:00am en minutos
    const end = 21*60 + 40; // 9:40pm
    while(start <= end){
      const h = Math.floor(start/60);
      const m = start%60;
      const ampm = h < 12 ? 'AM' : 'PM';
      const horaStr = `${h>12?h-12:h}:${m.toString().padStart(2,'0')} ${ampm}`;
      const option = document.createElement('option');
      option.value = horaStr;
      option.textContent = horaStr;
      horasSelect.appendChild(option);
      start += 40;
    }
  }
  generarHoras();

  // Actualizar horas no disponibles
  const barberoSelect = document.getElementById('barbero');
  async function actualizarHoras() {
    const barbero = barberoSelect.value;
    const fecha = document.getElementById('fecha').value;
    if(!barbero || !fecha) return;
    
    const snapshot = await db.ref(`citas/${barbero}/${fecha}`).once('value');
    const citas = snapshot.val() || {};
    
    Array.from(horasSelect.options).forEach(opt => {
      if(opt.value !== "") opt.disabled = citas[opt.value] ? true : false;
    });
  }

  barberoSelect.addEventListener('change', actualizarHoras);
  document.getElementById('fecha').addEventListener('change', actualizarHoras);

  // Enviar cita
  document.getElementById('enviar').addEventListener('click', async () => {
    const barbero = barberoSelect.value;
    const nombre = document.getElementById('nombre').value;
    const apellido = document.getElementById('apellido').value;
    const fecha = document.getElementById('fecha').value;
    const hora = horasSelect.value;
    if(!barbero || !nombre || !apellido || !fecha || !hora){
      alert("Por favor completa todos los campos");
      return;
    }

    // Guardar en Firebase
    await db.ref(`citas/${barbero}/${fecha}/${hora}`).set({nombre, apellido});

    // Enviar a WhatsApp
    const mensaje = `üíà *LA ZONA DEL BARBERO* üíà%0ABarbero: ${barbero}%0ANombre: ${nombre} ${apellido}%0AFecha: ${fecha}%0AHora: ${hora}%0A‚ú® Cita agendada con √©xito!`;
    window.open(`https://api.whatsapp.com/send?phone=573233489369&text=${mensaje}`, '_blank');

    alert("Cita agendada con √©xito!");
    actualizarHoras();
  });
</script>
</body>
</html>
